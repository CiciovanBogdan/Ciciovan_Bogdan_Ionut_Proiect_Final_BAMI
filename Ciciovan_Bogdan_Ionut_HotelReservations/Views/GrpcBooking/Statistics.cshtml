@model BookingCalculationsGrpcService.StatsReply

@{
    ViewData["Title"] = "Booking Statistics";
}

<div class="container mt-4">
    <h2 class="mb-4">
        <i class="bi bi-graph-up-arrow"></i> Booking Statistics
        <span class="badge bg-success">gRPC</span>
    </h2>

    @if (ViewBag.Error != null)
    {
        <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle"></i>
            @ViewBag.Error
        </div>
    }
    else if (Model != null)
    {
        <div class="row g-4 mb-4">
            <!-- Total Bookings -->
            <div class="col-md-4">
                <div class="card text-center shadow-sm border-primary">
                    <div class="card-body">
                        <i class="bi bi-calendar-check" style="font-size: 2.5rem; color: #0d6efd;"></i>
                        <h3 class="mt-3 fw-bold text-primary">@Model.TotalBookings</h3>
                        <p class="text-muted mb-0">Total Bookings</p>
                    </div>
                </div>
            </div>

            <!-- Not Canceled -->
            <div class="col-md-4">
                <div class="card text-center shadow-sm border-success">
                    <div class="card-body">
                        <i class="bi bi-check-circle" style="font-size: 2.5rem; color: #198754;"></i>
                        <h3 class="mt-3 fw-bold text-success">@Model.NotCanceledBookings</h3>
                        <p class="text-muted mb-0">Active Bookings</p>
                    </div>
                </div>
            </div>

            <!-- Canceled -->
            <div class="col-md-4">
                <div class="card text-center shadow-sm border-danger">
                    <div class="card-body">
                        <i class="bi bi-x-circle" style="font-size: 2.5rem; color: #dc3545;"></i>
                        <h3 class="mt-3 fw-bold text-danger">@Model.CanceledBookings</h3>
                        <p class="text-muted mb-0">Canceled Bookings</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <!-- Cancellation Rate -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-warning">
                        <i class="bi bi-percent"></i> Cancellation Rate
                    </div>
                    <div class="card-body text-center">
                        <h1 class="display-4 fw-bold"
                            style="color: @(Model.CancellationRate > 50 ? "#dc3545" : Model.CancellationRate > 25 ? "#ffc107" : "#198754")">
                            @Model.CancellationRate.ToString("F2")%
                        </h1>
                        <div class="progress mt-3" style="height: 30px;">
                            <div class="progress-bar @(Model.CancellationRate > 50 ? "bg-danger" : Model.CancellationRate > 25 ? "bg-warning" : "bg-success")"
                                 role="progressbar"
                                 style="width: @Model.CancellationRate%"
                                 aria-valuenow="@Model.CancellationRate"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                @Model.CancellationRate.ToString("F1")%
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Average Price -->
            <div class="col-md-6">
                <div class="card shadow-sm">
                    <div class="card-header bg-info text-dark">
                        <i class="bi bi-currency-dollar"></i> Average Price Per Room
                    </div>
                    <div class="card-body text-center">
                        <h1 class="display-4 fw-bold text-info">
                            $@Model.AveragePrice.ToString("F2")
                        </h1>
                        <p class="text-muted mb-0">Average across all bookings</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Stats -->
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <i class="bi bi-people"></i> Guest Information
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-6">
                        <i class="bi bi-people-fill" style="font-size: 2rem; color: #6c757d;"></i>
                        <h4 class="mt-2 fw-bold">@Model.TotalGuests</h4>
                        <p class="text-muted mb-0">Total Guests (Adults + Children)</p>
                    </div>
                    <div class="col-md-6">
                        <i class="bi bi-person-check" style="font-size: 2rem; color: #6c757d;"></i>
                        <h4 class="mt-2 fw-bold">@(Model.TotalBookings > 0 ? (Model.TotalGuests / (double)Model.TotalBookings).ToString("F1") : "0")</h4>
                        <p class="text-muted mb-0">Average Guests Per Booking</p>
                    </div>
                </div>
            </div>
        </div>
    }

    <div class="mt-4">
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back to Menu
        </a>
        <button onclick="location.reload()" class="btn btn-outline-primary">
            <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
    </div>
</div>